<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>è´¦ç›® Â· iBudget</title>
    <style>
        :root{--bg:#f7f8f9;--card:#ffffff;--text:#0f172a;--muted:#64748b;--line:#e5e7eb;--accent:#0a84ff}

        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --muted: #94a3b8;
            --line: #334155;
            --accent: #38bdf8;
        }

        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,system-ui}
        .container{max-width:1080px;margin:0 auto;padding:24px}
        .header{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
        .nav a{color:var(--muted);text-decoration:none;margin-left:12px}
        .surface{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 1px 2px rgba(15,23,42,.04)}
        .section-title{display:flex;align-items:center;gap:8px;margin:0 0 12px 0;font-size:16px;font-weight:600}
        .grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
        .grid-4{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}

        label{font-size:12px;color:var(--muted);font-weight: 600; margin-bottom: 4px; display: block;}

        input,select{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;outline:none;background:#fff;color:var(--text);font-size: 14px;}
        [data-theme="dark"] input, [data-theme="dark"] select { background: #0f172a; }
        input:focus{border-color:var(--accent);box-shadow: 0 0 0 2px rgba(56,189,248,0.2)}

        /* æ—¥å†æµ®çª—æ ·å¼ */
        .datepicker-popover {
            position: absolute;
            z-index: 1000;
            width: 280px;
            background: var(--card);
            border: 2px solid var(--line);
            border-radius: 16px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            display: none;
        }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; }
        .cal-day-head { font-size: 11px; color: var(--muted); padding: 5px 0; font-weight: 700; }
        .cal-date { padding: 8px 0; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 13px; color: var(--text); border: 1px solid transparent; }
        .cal-date:hover { background: var(--bg); border-color: var(--accent); }

        .cal-today {
            color: var(--accent) !important;
            font-weight: 800 !important;
            background: rgba(56, 189, 248, 0.15);
            border: 1.5px solid var(--accent) !important;
        }

        .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);background:#fff;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight: 600}
        [data-theme="dark"] .btn:not(.btn-primary) { background: #1e293b; }
        .btn-primary{background:var(--accent);border-color:var(--accent);color:#0f172a}

        .hint { font-size: 10px; color: var(--muted); margin-top: 4px; }
    </style>
</head>
<body>

<div id="calendarPopover" class="datepicker-popover">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <button class="btn" style="padding: 4px 10px" id="calPrevMonth">Â«</button>
        <div id="calHeader" style="font-weight: 800; font-size: 14px; color: var(--text);"></div>
        <button class="btn" style="padding: 4px 10px" id="calNextMonth">Â»</button>
    </div>
    <div class="cal-grid">
        <div class="cal-day-head">ä¸€</div><div class="cal-day-head">äºŒ</div><div class="cal-day-head">ä¸‰</div>
        <div class="cal-day-head">å››</div><div class="cal-day-head">äº”</div><div class="cal-day-head">å…­</div>
        <div class="cal-day-head">æ—¥</div>
    </div>
    <div class="cal-grid" id="calGridDays"></div>
</div>

<div class="container">
    <div class="header">
        <div style="font-weight: 900; font-size: 1.5rem;">iBudget</div>
        <div class="nav">
            <a href="/transactions.html">è´¦ç›®</a>
            <a href="/budgets.html">é¢„ç®—</a>
            <a href="/trends.html">è¶‹åŠ¿</a>
            <a href="/charts.html">å›¾è¡¨</a>
            <a href="#" id="themeToggle" style="color: var(--accent); font-weight: 800; margin-left: 20px;">åˆ‡æ¢ä¸»é¢˜</a>
        </div>
    </div>

    <div class="surface" style="margin-bottom:16px">
        <div class="section-title">ğŸ“ æ–°å¢/ç¼–è¾‘è´¦ç›®</div>
        <div class="grid-3">
            <div><label>ç±»å‹</label><select id="txType"><option value="EXPENSE">æ”¯å‡º</option><option value="INCOME">æ”¶å…¥</option></select></div>
            <div><label>é‡‘é¢</label><input id="txAmount" type="number" step="0.01"></div>
            <div><label>åˆ†ç±»</label><input id="txCategory"></div>
            <div style="grid-column:1/-1"><label>æè¿°</label><input id="txDesc"></div>
            <div style="grid-column:1/-1">
                <label>æ—¥æœŸä¸æ—¶é—´ (å¯ç‚¹å‡»æ—¥å†åæ‰‹åŠ¨ä¿®æ”¹ T åçš„æ•°å€¼)</label>
                <input id="txDate" class="dt-trigger" placeholder="YYYY-MM-DDTHH:mm:ss">
                <div class="hint">ç¤ºä¾‹æ ¼å¼ï¼š2025-12-23T14:30:00</div>
            </div>
        </div>
        <div style="margin-top:16px; display:flex; gap:12px;">
            <button class="btn btn-primary" id="btnSaveTx">ä¿å­˜è´¦ç›®</button>
            <button class="btn" id="btnResetTx">é‡ç½®è¾“å…¥</button>
        </div>
    </div>

    <div class="surface" style="margin-bottom:16px">
        <div class="section-title">ğŸ” æŸ¥è¯¢è¿‡æ»¤</div>
        <div class="grid-4">
            <div><label>å¼€å§‹æ—¶é—´</label><input id="fStart" class="dt-trigger" placeholder="èµ·å§‹æ—¶é—´"></div>
            <div><label>ç»“æŸæ—¶é—´</label><input id="fEnd" class="dt-trigger" placeholder="ç»“æŸæ—¶é—´"></div>
            <div><label>åˆ†ç±»æœç´¢</label><input id="fCategory" placeholder="è¾“å…¥åˆ†ç±»"></div>
            <div><label>ç±»å‹</label><select id="fType"><option value="">å…¨éƒ¨</option><option value="EXPENSE">æ”¯å‡º</option><option value="INCOME">æ”¶å…¥</option></select></div>
        </div>
        <div style="margin-top:16px; display:flex; gap:12px;">
            <button class="btn btn-primary" id="btnApplyFilters">æ‰§è¡Œç­›é€‰</button>
            <button class="btn" id="btnClearFilters">é‡ç½®ç­›é€‰</button>
        </div>
    </div>
</div>

<script>
    let displayDate = new Date();
    let activeInput = null;
    const popover = document.getElementById('calendarPopover');

    function renderCalendar() {
        const grid = document.getElementById('calGridDays');
        const header = document.getElementById('calHeader');
        grid.innerHTML = '';
        const year = displayDate.getFullYear();
        const month = displayDate.getMonth();
        header.innerText = `${year}å¹´ ${month + 1}æœˆ`;

        const now = new Date();
        const firstDay = new Date(year, month, 1).getDay();
        const startOffset = firstDay === 0 ? 6 : firstDay - 1;
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < startOffset; i++) grid.appendChild(document.createElement('div'));

        for (let d = 1; d <= daysInMonth; d++) {
            const div = document.createElement('div');
            div.className = 'cal-date';
            if (year === now.getFullYear() && month === now.getMonth() && d === now.getDate()) div.classList.add('cal-today');
            div.innerText = d;

            div.onclick = (e) => {
                e.stopPropagation();
                const datePart = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;

                // æ™ºèƒ½ä¿ç•™æ—¶é—´é€»è¾‘ï¼šå¦‚æœç”¨æˆ·å·²ç»è¾“å…¥äº†æ—¶é—´ï¼Œä¿ç•™å®ƒï¼›å¦åˆ™é»˜è®¤12ç‚¹
                let timePart = "12:00:00";
                if (activeInput.value && activeInput.value.includes('T')) {
                    const parts = activeInput.value.split('T');
                    if (parts[1]) timePart = parts[1];
                }

                activeInput.value = `${datePart}T${timePart}`;
                hideCalendar();
                activeInput.focus(); // é€‰ä¸­åç„¦ç‚¹å›åˆ°è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿é”®å…¥æ—¶åˆ†ç§’
            };
            grid.appendChild(div);
        }
    }

    function showCalendar(input) {
        activeInput = input;
        const rect = input.getBoundingClientRect();
        popover.style.display = 'block';
        popover.style.top = (rect.bottom + window.scrollY + 8) + 'px';
        popover.style.left = (rect.left + window.scrollX) + 'px';
        renderCalendar();
    }

    function hideCalendar() { popover.style.display = 'none'; }

    // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œä½†ä¸é”å®šè¾“å…¥ï¼ˆå»æ‰äº† readonlyï¼‰
    document.querySelectorAll('.dt-trigger').forEach(el => {
        el.onclick = (e) => { e.stopPropagation(); showCalendar(el); };
    });

    document.addEventListener('click', (e) => {
        if (!popover.contains(e.target) && !e.target.classList.contains('dt-trigger')) hideCalendar();
    });

    document.getElementById('calPrevMonth').onclick = (e) => { e.stopPropagation(); displayDate.setMonth(displayDate.getMonth() - 1); renderCalendar(); };
    document.getElementById('calNextMonth').onclick = (e) => { e.stopPropagation(); displayDate.setMonth(displayDate.getMonth() + 1); renderCalendar(); };

    document.getElementById('themeToggle').onclick=(e)=>{
        e.preventDefault();
        const t = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
        document.documentElement.dataset.theme = t;
        localStorage.setItem('theme', t);
    };
    document.documentElement.dataset.theme = localStorage.getItem('theme') || 'light';
</script>
</body>
</html>